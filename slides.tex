\documentclass[aspectratio=1610,14pt,t]{beamer}

% Colors
\usepackage{color}
\definecolor{mainorange}{HTML}{EC811B}
\definecolor{lightgrey}{HTML}{888888}
\definecolor{almostwhite}{HTML}{FEFEFE}

% Syntax highlighting
\usepackage{minted}
\usepackage{alltt}
\newcommand\hi[1]{{\color{mainorange} \textbf{#1}}}

\usepackage{wasysym}

% Custom unicode symbols
\usepackage{newunicodechar}
\newcommand\Warning{%
 \makebox[1.4em][c]{%
 \makebox[0pt][c]{\raisebox{.1em}{\small!}}%
 \makebox[0pt][c]{\color{red}\Large$\bigtriangleup$}}}%

\newunicodechar{⚠}{\Warning}

% Theme
\usetheme[%
  subsectionpage=progressbar,
  numbering=fraction,
  progressbar=foot,
]{metropolis}

% Customization
\usepackage{pagecolor}
\setbeamertemplate{section in toc}[sections numbered]
\setbeamerfont{title}{size=\fontsize{30}{30}}
\setbeamerfont{block title}{size=\large}
\newcommand\sep{\textcolor{lightgrey}{\rule{\linewidth}{0.05mm}}}

% Positioning
% https://tex.stackexchange.com/a/34929/13059
\def\Put(#1,#2)#3{\leavevmode\makebox(0,0){\put(#1,#2){#3}}}

% Meta
\title{Embedded Rust}
\date{2020-03-16}
\author{Raphael Nestler (@rnestler), Noah Hüsser (@Yatekii)}
\institute{Rust Zürichsee Meetup}

\begin{document}

\pgfdeclareimage[width=\paperwidth]{bg}{background-dark.pdf}
\pagecolor{almostwhite}  % Prevent speakerdeck from optimizing away the bg color
\usebackgroundtemplate{\pgfuseimage{bg}}
\maketitle

% ----------------------------------------------------------------- %

\begin{frame}[c]{println!("\{:?\}", rnestler)}
  Hi! I'm Raphael (@rnestler).

  \pause I live in Rapperswil

  \pause I work at Sensirion ({\small \url{https://sensirion.com}}).

  \pause I'm a founding member of Coredump\\hackerspace ({\small \url{https://coredump.ch}}).
\end{frame}

\begin{frame}[c]{println!("\{:?\}", yatekii)}
  Hi! I'm Noah (@Yatekii).

  \pause I live in Lenzburg

  \pause I work at Technokrat ({\small \url{https://technokrat.ch/}}).

  \pause I started the probe.rs project ({\small \url{https://probe.rs}}).
\end{frame}

% ----------------------------------------------------------------- %

\begin{frame}[plain,noframenumbering]
  \frametitle{Outline}
  \setcounter{tocdepth}{1}
  \tableofcontents
\end{frame}

% ----------------------------------------------------------------- %

\pgfdeclareimage[width=\paperwidth]{bg}{background-light.pdf}
\usebackgroundtemplate{\pgfuseimage{bg}}

\section{Embedded Programming}

\begin{frame}[c]{What is an \emph{Embedded System}?}
  \begin{quote}
    A combination of computer hardware and software, and perhaps
    additional mechanical or other parts, designed to perform a dedicated
    function.
  \end{quote}
  Michael Barr. ``Embedded Systems Glossary''\footnote{\tiny\url{https://barrgroup.com/Embedded-Systems/Glossary-E\#embedded\_system}}
\end{frame}

\begin{frame}[c]{What is embedded programming?}
  \begin{itemize}
    \item Dedicated, not general purpose, µC system
    \item<1-> Baremetal
    \item<1-> Low-Level
    \item<2-> For this talk: Bare metal on Cortex-M MCUs
  \end{itemize}
\end{frame}

\begin{frame}[c]{Why do they say it's hard?}
  \begin{itemize}
    \item Harsh environment (No OS which protects you)
    \item Resource constrained (Remember dedicated?)
    \item Non-standard, Non-OSS toolchain
    \item Hard realtime requirements
    \item \ldots
  \end{itemize}
\end{frame}

\begin{frame}[c]{Why is Rust awesome for it?}
  \begin{itemize}
    \item Zero cost abstractions!
    \item Provides safety at compiler level, not OS
    \item Expressive type system to encode constraints
  \end{itemize}
\end{frame}

\section{State of Embedded in 2020}
\begin{frame}[c]{The compiler}
  \begin{itemize}
    \item \texttt{const fn}
      \begin{itemize}
        \item More functions from libcore
        \item More features (destructuring, bindings, assignment, \ldots)
      \end{itemize}
    \item \texttt{core::future::Future}
    \item \texttt{alloc} crate is stable
    \item \texttt{MaybeUninit<T>}: Fixes undefined behavior
  \end{itemize}
\end{frame}

\begin{frame}[c]{The compiler}
  \includegraphics[height=0.8\textheight]{img/did-i-forget-something.jpg}
\end{frame}

\begin{frame}[c]{\texttt{async} / \texttt{await} of course}

  \begin{quote}
    The \texttt{.await} is over, \texttt{async fn}s are here
  \end{quote}

  $\rightarrow$ We'll get to it
\end{frame}

\subsection{Embedded HAL}

\begin{frame}[c]{What is the Embedded HAL?}
  \begin{itemize}
  \item Unified interface to the same HW functionality which has different
    interfaces
  \item Higher level crates (drivers) are write once use always
  \item Nice examples: shtc3
    driver\footnote{\url{https://github.com/dbrgn/shtcx-rs}} developed and
    debugged on a  Raspberry Pi and used with an SMT32
  \end{itemize}
\end{frame}

\subsection{svd2rust}

\begin{frame}[c]{svd2rust}
  \begin{itemize}
    \item Every Cortex-M μC vendor must provide an SVD (System View
      Descriptions) file
    \item SVD is an XML standard to describe peripheral registers
    \item svd2rust\footnote{\url{https://github.com/japaric/svd2rust}}:
      Generate Rust register maps (structs) from SVD files
    \item Done for our μC family\footnote{\url{https://github.com/japaric/stm32f30x}}
  \end{itemize}
\end{frame}

\begin{frame}[c]{More Resources}
  \begin{itemize}
    \item The Rust Embedded Book\footnote{\url{https://docs.rust-embedded.org/book/}}
    \item The Embedded Bookshelf\footnote{\url{https://docs.rust-embedded.org/}}
    \item The Discovery book\footnote{\url{https://docs.rust-embedded.org/discovery/index.html}}
    \item Awesome Embedded Rust\footnote{\url{https://github.com/rust-embedded/awesome-embedded-rust}}
  \end{itemize}
\end{frame}

\section{probe.rs}

\begin{frame}[c]{Embedded debugging}
  \begin{itemize}
    % On an x86 target you can load the program directly from disk to RAM from with in your os.
    % Where you also coded, compiled and debugged your program.
    % You get convenient tools for output and interaction such as the commandline, a debugger or even a webbrowser.
    \item Software is written on a host instead of the target.
    % On a microchip we have no such feedback.
    % We develop the software, flash it to the microchip with a magic tool (at least to many folks it is)
    % and hope it runs properly. Oftentimes we have to measure HW signals with some special equippment.
    \item The microchip has no direct feedback.
    % We need a tool to talk with the chip. We somehow need our host to talk to the microchip.
    % To download the binary, to run a debugger and to do custom interaction.
    % Interfaces exist, but the PC doesn't understand them. Similar to an SPI peripheral and an SPI driver,
    % We need to write the driver for those interfaces. SWD and JTAG.
    \item A middleman is needed (soft- \& hardware).
    % This magic tool you always used but never really looked into is probe-rs, like many others.
    \item probe-rs
  \end{itemize}
\end{frame}

\begin{frame}[c]{Hardware Probes}
  \begin{itemize}
    \item CMSIS-DAP
    \item ST-Link
    \item JLink
    \item Blackmagic Probe
    \item ...
  \end{itemize}
\end{frame}

\begin{frame}[c]{OpenOCD}
  \begin{itemize}
    \item[+] Open Source
    \item[+] Highly configurable in TCL
    \item[+] Very mighty
      \begin{itemize}
        \item Supports 20+ different probes
        \item Supports many different CPUs
        \item Supports various architectures
        \item Supports SWD \& JTAG
      \end{itemize}
    \item[-] Ancient (released 2005, last stable release 2017)
    \item[-] Cumbersome to install, use, maintain \& contribute
    \item !\$
  \end{itemize}
\end{frame}

\begin{frame}[c]{pyOCD}
  \begin{itemize}
    \item[+] Open Source
    \item[+] Supports CMSIS-PACKs
    \item Written by ARM itself
    \item[-] Arm only
    \item[-] Written in Python
    \item[-] Limited and rather hard to use
    \item[-] SWD only
    \item[-] Supports only ST-Link and CMSIS-DAP
  \end{itemize}
\end{frame}

\begin{frame}[c]{STLink tooling}
  \begin{itemize}
    \item[+] Works great for ST MCUs
    \item[+] An open source clone exists
    \item[-] Closed Source
    \item[-] Written by ST
    \item[-] Only support for ST-Links \& ST MCUs
    \item[-] SWD only
    \item[-] Limited featureset
    \item \$\$
  \end{itemize}
\end{frame}

\begin{frame}[c]{Segger tooling}
  \begin{itemize}
    \item[+] Knows ALL the CPUs and hacks to get them running
    \item[+] SWD \& JTAG
    \item[-] Closed source
    \item[-] Works only with JLinks
    \item[-] Tooling is highly windows \& UI oriented
    \item[-] Inconsistent at times
    \item \$\$\$ (exception is EDU use)
  \end{itemize}
\end{frame}

\begin{frame}[c]{Blackmagic probe}
  \begin{itemize}
    \item[+] Open Source
    \item[-] Everything included in the probe
    \item[-] Fully GDB based
    \item \$
  \end{itemize}
\end{frame}

\begin{frame}[c]{Homebrew}
  \begin{itemize}
    \item Python
    \item C
    \item Simple scripts
  \end{itemize}
\end{frame}

\begin{frame}[c]{Current ecosystem}
  \begin{itemize}
    \item Everything is GDB based
      \begin{itemize}
        \item First release 1983
        \item Protocol is serial \& ASCII based
        \item Not intended for embedded
        \item Codebase is suboptimal
      \end{itemize}
    \item Different UI for every tool
    \item No proper integration with tools
  \end{itemize}
\end{frame}

\begin{frame}[c]{So what is probe.rs?}
  \begin{itemize}
    \item
  \end{itemize}
\end{frame}

\section{Future}

\begin{frame}[c]{Where do we want to go}
  \begin{itemize}
    \item
  \end{itemize}
\end{frame}

\begin{frame}[c]{Contribute}
  \begin{itemize}
    \item
  \end{itemize}
\end{frame}

% ----------------------------------------------------------------- %

{
\setbeamertemplate{footline}{}
\pgfdeclareimage[width=\paperwidth]{bg}{background-inverted.pdf}
\usebackgroundtemplate{\pgfuseimage{bg}}
\begin{frame}[standout]
  \begin{centering}
    {\Huge Thank you!}\\
    {\normalsize \url{https://coredump.ch}}\\
  \end{centering}
  {\small Slides: \url{https://github.com/rust-zurichsee/meetups/}}\\
  \vspace{3cm}
\end{frame}
}
\end{document}
